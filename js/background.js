function d(a){switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:return"Quota exceeded";case FileError.NOT_FOUND_ERR:return"File not found";case FileError.SECURITY_ERR:return"Security error";case FileError.INVALID_MODIFICATION_ERR:return"Invalid modification";case FileError.INVALID_STATE_ERR:return"Invalid state";default:return"Unknown Error"}}function f(a){$.event.trigger("filesystemerror");console.warn("FS Error:",d(a),a)}
function g(a,b,c){var e=new Blob([b],{type:"text/plain"});a.createWriter(function(a){a.onerror=f;a.onwrite=h.bind(null,a,e,c);a.truncate(e.size)})}function h(a,b,c){a.onwrite=c;a.write(b)};function k(){this.b=[];this.a=[]}function l(){var a=parseInt(navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10),b="other";-1!=navigator.appVersion.indexOf("Linux")?b="linux":-1!=navigator.appVersion.indexOf("CrOS")?b="cros":-1!=navigator.appVersion.indexOf("Mac OS X")&&(b="mac");return"linux"===b&&27>a||"mac"===b&&25>a}
k.prototype.c=function(){var a={id:"appWindow"+this.a.length,frame:l()?"chrome":"none",minWidth:400,minHeight:400,width:700,height:700};chrome.app.window.create("index.html",a,function(a){console.log("Window opened:",a);a.onClosed.addListener(this.f.bind(this,a))}.bind(this))};
k.prototype.e=function(a){var b=[];chrome.storage.local.get("retainedEntryIds",function(a){a=a.retainedEntryIds||[];for(var b=0;b<a.length;b++)chrome.fileSystem.restoreEntry(a[b],function(a){this.b.push(a)}.bind(this))}.bind(this));if(a&&a.items)for(var c=0;c<a.items.length;c++)b.push(a.items[c].entry);0==this.a.length&&this.c();for(c=0;c<b.length;c++)chrome.fileSystem.getWritableEntry(b[c],function(a){0<this.a.length?this.a[0].openEntries([a]):this.b.push(a)}.bind(this))};
k.prototype.f=function(a){console.log("Window closed:",a);if(a.contentWindow&&a.contentWindow.textApp){a=a.contentWindow.textApp;for(var b=0;b<this.a.length;b++)a===this.a[b]&&this.a.splice(b,1);var c=a.getFilesToSave();console.log("Got "+c.length+" files to save:",c);for(b=0;b<c.length;b++)m(c[b].h,c[b].contents);a=a.getFilesToRetain();console.log("Got "+a.length+" files to retain:",a);b=[];for(c=0;c<a.length;c++){var e=chrome.fileSystem.retainEntry(a[c]);b.push(e)}chrome.storage.local.set({retainedEntryIds:b})}else console.warn("No Text.app object in the window being closed:",
a.contentWindow,a.contentWindow.textApp)};function m(a,b){g(a,b,function(){console.log("Saved",a.name)})}k.prototype.g=function(a){this.a.push(a);a.setHasChromeFrame(l());0<this.b.length?(a.openEntries(this.b),this.b=[]):a.openNew()};k.prototype.d=function(a,b){chrome.fileSystem.getWritableEntry(a,b)};var n=new k;chrome.app.runtime.onLaunched.addListener(n.e.bind(n));window.background=n;k.prototype.copyFileEntry=k.prototype.d;k.prototype.onWindowReady=k.prototype.g;k.prototype.newWindow=k.prototype.c;